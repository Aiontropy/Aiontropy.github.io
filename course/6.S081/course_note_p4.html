<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>6.S081 LEC4 | Aiontropy</title>
    <meta name="description" content="blog">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/assets/style.BOSx6zLo.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.DcnFVaJ2.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.IaJf7RXr.js">
    <link rel="modulepreload" href="/assets/chunks/framework.tuuL-SzM.js">
    <link rel="modulepreload" href="/assets/course_6.S081_course_note_p4.md.DgjJafgJ.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/" data-v-1168a8e4><!--[--><!--]--><!----><span data-v-1168a8e4>Aiontropy</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!----></div><!----><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://aiontropy.github.io/" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://aiontropy.github.io/" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>base</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/base/operating_systems/operating_systems" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>operating systems</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>coursei</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/course/6.S081/6.S081" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>6.S081</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _course_6_S081_course_note_p4" data-v-39a288b8><div><h1 id="_6-s081-lec4" tabindex="-1">6.S081 LEC4 <a class="header-anchor" href="#_6-s081-lec4" aria-label="Permalink to &quot;6.S081 LEC4&quot;">​</a></h1><p>Page Tables.</p><h2 id="页表-page-tables" tabindex="-1">页表 (Page tables) <a class="header-anchor" href="#页表-page-tables" aria-label="Permalink to &quot;页表 (Page tables)&quot;">​</a></h2><h3 id="隔离-isolution" tabindex="-1">隔离 (Isolution) <a class="header-anchor" href="#隔离-isolution" aria-label="Permalink to &quot;隔离 (Isolution)&quot;">​</a></h3><p>使用虚拟内存可以获得强隔离性。</p><h3 id="地址空间-address-spaces" tabindex="-1">地址空间 (Address spaces) <a class="header-anchor" href="#地址空间-address-spaces" aria-label="Permalink to &quot;地址空间 (Address spaces)&quot;">​</a></h3><p>为什么要有地址空间？假如现在有一个场景，内存地址 1000-2000 是程序 A 的地址，内存地址 3000-4000 是程序 B 的地址，程序 B 执行了一个向 100 地址的写操作，然后这个操作就会被写道程序 A 的地址中，这样就打破了内存隔离。</p><p>它的基本思想很简单，就是我们给每个程序，包括内核分配自己的地址空间。不适用地址空间，就像把内存比作一桶水，每个程序都可以任意污染水，而内存地址就像把水用杯子装起来，每个程序都只能污染自己的那一杯水。这样就实现了强隔离性。</p><h3 id="页表-page-tables-1" tabindex="-1">页表 (Page tables) <a class="header-anchor" href="#页表-page-tables-1" aria-label="Permalink to &quot;页表 (Page tables)&quot;">​</a></h3><p>实现地址空间最常见方法就是使用<strong>页表</strong>，这通常是由处理器或者 <strong>内存管理单元(Memory Manager Unit MMU)</strong> 的硬件实现的。当 CPU 执行任何和地址有关的指令时，这个地址都是虚拟地址，虚拟地址通过 MMU 转换成物理地址，然后使用这个物理地址在内存中索引，进行操作。<br> 在 MMU 中，通常存储着一张不完整的表，它叫做 <strong>转换检测缓冲区(Translation Lookaside Buffer)</strong> ，表的一个字段是虚拟地址，另一个字段是物理地址，这张完整的表通常保存在内存中。 CPU 会由一个寄存器存储这张表的位置， RISC-V 中，这个寄存器叫做 <strong>satp</strong> ，保存着表在内存中的地址，当要寻找地址时， CPU 会告诉 MMU 在哪里可以找到这张完整的表，当 CPU 切换进程运行的时候，也会切换 stap 寄存器，指向运行的程序的映射，而被写进 satp 的值是由内核保存的。</p><h2 id="栈" tabindex="-1">栈 <a class="header-anchor" href="#栈" aria-label="Permalink to &quot;栈&quot;">​</a></h2><p>内核栈位于内存中较高的位置，原因是有一个没有映射的 <strong>守护页(Guard page)</strong> 在它的下面，内核栈下面的一些内存会是无效内存，如果栈溢出，出现页错误，也只会溢出到无效内存中，这样也比其他的内核内存被修改比较合理。</p><blockquote><p>守护页只存在于虚拟地址中，它没有对应的物理地址，因此也不会消耗物理内存。</p></blockquote><p>每个用户程序都有自己的用户栈。</p></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><!----></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/base/operating_systems/operating_systems" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>operating systems</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api-examples.md\":\"Bom9wPq4\",\"base_operating_systems_operating_systems.md\":\"CAfFIrvc\",\"computer_sciences_blockchain_index.md\":\"BOp_s8bf\",\"computer_sciences_blockchain_part_1_basic_blackchain.md\":\"DHFIjGFH\",\"computer_sciences_blockchain_part_2_proof_of_work.md\":\"Bqge3pz1\",\"computer_sciences_blockchain_part_3_persistence_and_cli.md\":\"CzIuTcZg\",\"computer_sciences_blockchain_part_4_transactions1.md\":\"BBtqn8VB\",\"computer_sciences_blockchain_part_5_addresses.md\":\"Dd4GjrXA\",\"course_6.s081_course_note_p1.md\":\"BeHNdOv6\",\"course_6.s081_course_note_p3.md\":\"CMbVjxu1\",\"course_6.s081_course_note_p4.md\":\"DgjJafgJ\",\"course_6.s081_index.md\":\"B_QtTFYy\",\"course_6.s081_lab1.md\":\"BhAhSEoU\",\"course_6.s081_lab2.md\":\"pP_pa4BJ\",\"index.md\":\"B_juNalC\",\"markdown-examples.md\":\"Cglqg7tx\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Aiontropy\",\"description\":\"blog\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"sidebar\":[{\"text\":\"base\",\"items\":[{\"text\":\"operating systems\",\"link\":\"/base/operating_systems/operating_systems\"}]},{\"text\":\"coursei\",\"items\":[{\"text\":\"6.S081\",\"link\":\"/course/6.S081/6.S081\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://aiontropy.github.io/\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>