<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Address | Aiontropy</title>
    <meta name="description" content="blog">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/assets/style.BOSx6zLo.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.Bsr6xIsz.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.sZMdFR61.js">
    <link rel="modulepreload" href="/assets/chunks/framework.BD_Yrv4e.js">
    <link rel="modulepreload" href="/assets/computer_sciences_blockchain_part_5_addresses.md.CasDg-gp.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/" data-v-1168a8e4><!--[--><!--]--><!----><span data-v-1168a8e4>Aiontropy</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!----></div><!----><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://aiontropy.github.io/" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://aiontropy.github.io/" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>course</h2><!----></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="./course/6.S081/6.S081" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>6.S081</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="./course/CMU_15-445/CMU_15-445" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>CMU_15-445</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _computer_sciences_blockchain_part_5_addresses" data-v-39a288b8><div><h1 id="address" tabindex="-1">Address <a class="header-anchor" href="#address" aria-label="Permalink to &quot;Address&quot;">​</a></h1><h2 id="btc-address" tabindex="-1">BTC Address <a class="header-anchor" href="#btc-address" aria-label="Permalink to &quot;BTC Address&quot;">​</a></h2><p>这是一个 BTC 的真实地址: [1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa](h ttps://blockchain.info/address/1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa)。这是 BTC 历史上的第一个地址，据说是中本聪。 BTC 的地址是公开的，只要知道地址，就可以向它转账。虽然地址是独一无二的，但是地址不是一个“钱包”的所有者，地址实际上只是一种公钥。 BTC 中，你本人的身份就是一对或者多对保存在电脑上的公钥 + 私钥。</p><blockquote><p>类似于银行卡号，可以通过卡号向对方转账，但是不能通过卡号使用里面的钱，只有拥有密码（私钥）才能使用里面的钱。</p></blockquote><h2 id="public-key-cryptoggraphy" tabindex="-1">Public-key Cryptoggraphy <a class="header-anchor" href="#public-key-cryptoggraphy" aria-label="Permalink to &quot;Public-key Cryptoggraphy&quot;">​</a></h2><p><strong>公钥加密 （Public-key Cryptoggraphy）</strong> 是使用成对的密钥：公钥和私钥，公钥不是敏感信息，可以告诉任何人，但是私钥是敏感信息，谁都不可以告诉。能识别，鉴定和证明所有者身份的就是私钥，在加密货币的世界中，私钥代表的就是你，私钥就等于你这个人。</p><p>实际上， BTC 的钱包就是一对密钥，当你安装钱包的应用或者使用 BTC 的客户端的时候会为你生成一个新的地址，一对密钥。谁拥有这个密钥，谁就可以使用所有被发送到对应公钥的币。</p><p>公钥和私钥是随机的字节序列，因此人类无法通过肉眼识别。这就是为什么 BTC 使用了一个转换算法，将公钥转换成一个人类可读的字符串，这段字符串就是地址。不直接使用公钥做地址的原因是：缩短长度 (65B -&gt; 20B) ， 隐藏公钥，延迟量子计算的威胁。</p><blockquote><p>如果你是用过 BTC 钱包的应用， 它很可能会给你生成一个助记符，这样的助记符可以用来代替私钥，并且可以被用于生成私钥。 <a href="D:%5Ct%5Cnvim-win64%5Cbin" target="_blank" rel="noreferrer">BIP-039</a> 已经实现了 这个机制。</p></blockquote><h2 id="digital-signatures" tabindex="-1">Digital Signatures <a class="header-anchor" href="#digital-signatures" aria-label="Permalink to &quot;Digital Signatures&quot;">​</a></h2><p>数学和密码学中，有一个 <strong>数字签名（digital signature）</strong> 的概念，它能保证：</p><ol><li>当数据聪发送方传输到接收方时，数据不会被修改</li><li>数据由某一确定的发送方创建</li><li>发送方无法否认数据被发送过这一事实</li></ol><p>数据通过签名算法，会获得一个签名，可以保证后续都被验证。生成签名需要一个私钥，验证签名需要使用公钥。数字签名类似于盖章，检查公章是否和对方的公章一致（确认身份），检查内容是否被涂改（确认完整性）。<br> 要对数据进行签名加密，需要数据和私钥。要对数据进行签名验证，需要被签名的数据，签名，公钥。</p><blockquote><p>大体流程：对数据进行哈希，然后将哈希得到的结果用私钥进行加密，得到签名，将数据和签名一并发送出去，接收方收到数据后，使用公钥对签名进行解密得到数据的哈希，然后将数据哈希的结果和解密得到的哈希进行对比，如果相同则身份验证成功，数据也是完整的。</p></blockquote><p>注意：签名并不会对数据进行加密，只会验证身份和完整性。 BTC 并没有使用加密算法</p><p>回顾一个交易完整的生命周期：</p><ol><li>最开始，创世块中只有一个 coinbase 交易，再 coinbase 交易中，没有输入，所以也不需要签名算法。 coinbase 交易的输出包含了一个哈希过的公钥（使用的是 RIPEMD16(SHA256(PubKey)) 算法）</li><li>当一个人发送币的时候，就会创建一笔交易。这笔交易的输入会引用之前交易的输出，每个输入会存储一个公钥（没有被哈希）和完整的交易的一个签名</li><li>BTC 网络中接收到交易的其他节点会对该交易进行验证。他们还会检查：再一个输入中，公钥哈希与所引用的输出的哈希是否匹配（这保证了发送方只能发挥属于自己的币）；签名是正确的（这保证了交易是由币的实际拥有者创建的）</li><li>当一名矿工准备挖一个新的区块时，他会将交易放到区块中，然后开始挖矿</li><li>当新的区块被挖出来后，网络中的所有其他节点会收到一条消息，告诉其他人这个区块已经被挖出来了，并且已经被加入到区块链中了</li><li>当一个区块被加入到区块链后，交易就算完成了，它的输出就可以在新的交易中被引用</li></ol><h2 id="elliptic-curve-cryptoggraphy" tabindex="-1">Elliptic Curve Cryptoggraphy <a class="header-anchor" href="#elliptic-curve-cryptoggraphy" aria-label="Permalink to &quot;Elliptic Curve Cryptoggraphy&quot;">​</a></h2><p>公钥和私钥是随机的字节序列。私钥能够用于证明持币人的身份，需要有一个条件：随机算法必须生成真正随机的字节。因为没有人会想要生成一个私钥，而这个私钥意外地也被别人所有。</p><p>比特币使用椭圆曲线来产生私钥。椭圆曲线是一个复杂的数学概念，这里不打算在这里作太多解释（如果你真的十分好奇，可以查看<a href="http://andrea.corbellini.name/2015/05/17/elliptic-curve-cryptography-a-gentle-introduction/" target="_blank" rel="noreferrer">这篇文章</a>，注意：有很多数学公式！）只要知道这些曲线可以生成非常大的随机数就够了。在比特币中使用的曲线可以随机选取在 0 与 2 ^ 2 ^ 56（大概是 10^77, 而整个可见的宇宙中，原子数在 10^78 到 10^82 之间） 的一个数。有如此高的一个上限，意味着几乎不可能发生有两次生成同一个私钥的事情。</p><p>比特币使用的是 <strong>ECDSA（Elliptic Curve Digital Signature Algorithm）</strong> 算法来对交易进行签名，这里也会使用该算法。</p><h2 id="base58" tabindex="-1">Base58 <a class="header-anchor" href="#base58" aria-label="Permalink to &quot;Base58&quot;">​</a></h2><p>回到上面提到的比特币地址：<code>1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa</code> 。现在已经知道了这是公钥，用人类可读的形式表示而已，只需要对它解码，就能看到它原本的样子（十六进制）。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>0062E907B15CBF27D5425399EBF6F0FB50EBB88F18C29B7D93</span></span></code></pre></div><p>BTC 使用的是 Base58 算法，将公钥转换成人类可读的形式。它跟 Base64 类似，主要的区别就在于排除的字符： <code>0</code> （零）、<code>O</code> （大写o）、 <code>I</code> （大写i）、 <code>l</code> （小写L）、 <code>+</code> 、 <code>/</code> ，并且不会使用 <code>=</code> 进行填充，通过精简字符集降低错误率。 下图是从一个公钥获取一个地址的过程：<br><img src="/assets/address-generation-scheme.hCHuuzdi.png" alt="Public-key2Address"> 上面提到的公钥解码后包含的三个部分：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Version  Public key hash                           Checksum</span></span>
<span class="line"><span>00       62E907B15CBF27D5425399EBF6F0FB50EBB88F18  C29B7D93</span></span></code></pre></div><p>由于哈希函数是单向的，也就是说不能逆转回去，因此不可能从一个哈希中提取公钥。但是可以通过执行哈希函数并进行哈希比较，用来检查一个哈希是否被用于哈希生成。</p><h2 id="implementing-address" tabindex="-1">Implementing Address <a class="header-anchor" href="#implementing-address" aria-label="Permalink to &quot;Implementing Address&quot;">​</a></h2><p>实现一个 “钱包” 的结构体：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Wallet</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	PrivateKey </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ecdsa</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PrivateKey</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	PublicKey  []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">byte</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Wallets</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	Wallets </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Wallet</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NewWallet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Wallet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	private, public </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> newKeyPair</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	wallet </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Wallet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{private, public}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wallet</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> newKeyPair</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ecdsa</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PrivateKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">byte</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	curve </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> elliptic.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">P256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	private, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ecdsa.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GenerateKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(curve, rand.Reader)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	pubKey </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(private.PublicKey.X.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Bytes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), private.PublicKey.Y.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Bytes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">private, pubKey</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>一个钱包是什么都没有的密钥对，我们还需要一个 <code>Wallets</code> 用来保存多个钱包的集合，后面还需要将他们保存到文件中，或者从文件中加载。 <code>Wallet</code> 的构造函数比较简单： ECDSA 基于椭圆曲线，所以需要一个椭圆曲线。接下来，使用椭圆生成一个私钥，然后再从私钥生成一个公钥。有一点需要注意：在基于椭圆曲线的算法中，公钥是曲线上的点。因此，公钥是 X，Y 坐标的组合。在比特币中，这些坐标会被连接起来，然后形成一个公钥。</p><p>现在，需要生成一个地址：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">w </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Wallet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GetAddress</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">byte</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	pubKeyHash </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HashPubKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(w.PublicKey)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	vaersionedPayload </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">byte</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{version}, pubKeyHash</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	checksum </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> checksum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vaersionedPayload)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	fullPayload </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> append</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vaersionedPayload, checksum</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	address </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Base58Encode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fullPayload) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 自己实现一个 base58 编码的函数</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> address</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HashPubKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pubKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">byte</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">byte</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	publicSHA256 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sha256.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Sum256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pubKey)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	RIPEMD160Hasher </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ripemd160.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">New</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	_, err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RIPEMD160Hasher.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(publicSHA256[:])</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Panic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	publicRIPEMD160 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RIPEMD160Hasher.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> publicRIPEMD160</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> checksum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">payload</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">byte</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">byte</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	firstSHA </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sha256.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Sum256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(payload)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	secondSHA </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sha256.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Sum256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(firstSHA[:])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> secondSHA[:addressChecksumLen]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>将公钥转换成一个 Base58 需要的步骤：</p><ol><li>使用 <code>RIPEMD16(SHA256(PubKey))</code> 哈希算法，取公钥并对其哈希两次。</li><li>给哈希加上地址生成算法版本前缀，然后和第一步的结果拼接。</li><li>将第二步的结果再进行 <code>SHA256(SHA256(payload))</code> 哈希，返回结果的前四个字节，前四个字节已经足够校验绝大多数情况了。</li><li>最后使用 Base58 对 <code>versionedPayload + pubKeyHash + checksum</code> 的组合编码。</li></ol><p>这样，就获得了一个 ** 真实的比特币地址** ，你甚至可以在 <a href="https://blockchain.info/" target="_blank" rel="noreferrer">blockchain.info</a> 查询它的余额。不过无论生成一个新的地址多少次，检查它的余额都是 0 。这里也体现了加密算法的重要性，由于私钥使用的是随机数，生成同一个数字的概率需要经可能接近 0 ，理想情况应该是用于不会出现重复。</p><p>现在幼修改输入和输出来使用地址:</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TXInput</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	Txid      []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">byte</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	Vout      </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	Signature []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">byte</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	PubKey    []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">byte</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 传入没有被哈希的公钥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">in </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TXInput</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">UsesKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pubKeyHash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">byte</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	lockingHash </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HashPubKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(in.PubKey)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bytes.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Compare</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lockingHash, pubKeyHash) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TXOutput</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	Value      </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	PubKeyHash []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">byte</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">out </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TXOutput</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Lock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">address</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">byte</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	pubKeyHash </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Base58Decode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(address)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	pubKeyHash </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pubKeyHash[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pubKeyHash)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 去除版本号和校验位</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	out.PubKeyHash </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pubKeyHash</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 检查是否提供的公钥哈希被用于锁定输出</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">out </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TXOutput</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">IsLockedWithKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pubKeyHash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">byte</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bytes.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Compare</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(out.PubKeyHash, pubKeyHash) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>由于不会实现脚本语言，因此不需要 <code>ScriptPubKey</code> 和 <code>ScriptSig</code> 字段了。<code>ScriptSig</code> 会被分为 <code>Signature</code> 和 <code>PubKey</code> 字段，<code>ScriptPubKey</code> 被重命名为 <code>PubKeyHash</code> 。然后使用方法来实现输入的锁定/解锁和输入的签名。</p><p><code>UsesKey</code> 方法核查 <code>TXInput</code> 是否可以使用特定的未哈希的公钥来解锁一个 <code>TXOutput</code> 。 <code>IsLockedWithKey</code> 核查 <code>TXOutput</code> 是否被特定的哈希后的公钥锁定。 <code>UsesKey</code> 和 <code>IsLockedWithKey</code> 是互补函数， <code>FindUnspentTransactions</code> 函数使用这两个函数来构建交易间的关系。</p><p><code>Lock</code> 只是简单地锁定了一个输出。当给某个人发送币时，只知道他的地址，因为这个函数使用一个地址作为唯一的参数。然后，地址会被解码，从中提取出公钥哈希并保存在 <code>PubKeyHash</code> 字段。</p><h2 id="实现签名" tabindex="-1">实现签名 <a class="header-anchor" href="#实现签名" aria-label="Permalink to &quot;实现签名&quot;">​</a></h2><p>签名是保证不花费他人的币的唯一方式，因此交易必须被签名了才能使用，如果一个签名无效，那么该交易也是无效的，这笔交易也无法被加入到区块链中。</p><p>由于签名不会考虑发送方和接收方，同时需要包含唯一能够标识数据的信息，并且交易会解锁之前的输出，然后生成新的输出之后锁定，而且公钥中可能会包含签名，那么应该将这些数据进行签名：</p><ol><li>存储在已解锁输出的公钥哈希。它识别了一笔交易的“发送方”。</li><li>存储在新的锁定输出里面的公钥哈希。它识别了一笔交易的“接收方”。</li><li>新的输出值。</li></ol><blockquote><p>在 BTC 中，锁定/解锁逻辑被存储在脚本中，它们被分别存储在输入和输出的 <code>ScriptSig</code> 和 <code>ScriptPubKey</code> 字段。由于 BTC 允许这样不同类的脚本，它对 <code>ScriptPubKey</code> 的整个内容进行了签名。</p></blockquote><p>并不需要对输出中的公钥进行签名。因此并非对“原始”交易进行签名，而是被“修剪”后的副本。</p><blockquote><p>使用“修剪”副本的原因：避免递归签名问题，交易的输入看看你包含 <code>ScriptSig</code> ，如果直接签名整个交易，签名就会包含自身，出现递归。隔离关键数据，签名只需要关注交易的和兴逻辑，而不是临时生成的脚本。<a href="https://en.bitcoin.it/wiki/File:Bitcoin_OpCheckSig_InDetail.png" target="_blank" rel="noreferrer">详细过程</a></p></blockquote><p>先从 <code>Sign</code> 开始：</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><!----></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="./course/6.S081/6.S081" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>6.S081</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api-examples.md\":\"Bxy4VweU\",\"base_operating_systems_operating_systems.md\":\"D0el5lmq\",\"computer_sciences_blockchain_index.md\":\"Djmh6NfU\",\"computer_sciences_blockchain_part_1_basic_blackchain.md\":\"DGb6M0jR\",\"computer_sciences_blockchain_part_2_proof_of_work.md\":\"DRTi0I-7\",\"computer_sciences_blockchain_part_3_persistence_and_cli.md\":\"QjYTIlcP\",\"computer_sciences_blockchain_part_4_transactions1.md\":\"Bhu0gpyZ\",\"computer_sciences_blockchain_part_5_addresses.md\":\"CasDg-gp\",\"course_6.s081_another.md\":\"XjgYZI0N\",\"course_6.s081_course_note_p1.md\":\"BzURjmvL\",\"course_6.s081_course_note_p3.md\":\"BN-cFj-I\",\"course_6.s081_course_note_p4.md\":\"D2uLdXhf\",\"course_6.s081_index.md\":\"DDFex2-9\",\"course_6.s081_lab1.md\":\"2wMeIMP8\",\"course_6.s081_lab2.md\":\"DeLIA6vT\",\"course_6.s081_lab3.md\":\"B1Dj4vIG\",\"course_cmu_15-445_fall2025_hw1.md\":\"DsNdR6XG\",\"course_cmu_15-445_fall2025_index.md\":\"DbgXHBEl\",\"course_cmu_15-445_fall2025_lec1.md\":\"od0awK3O\",\"course_cmu_15-445_fall2025_lec2.md\":\"B8PUC7Zd\",\"course_cmu_15-445_fall2025_lec3.md\":\"DcPVd9ZL\",\"course_cmu_15-445_fall2025_lec4.md\":\"V3mbGjlk\",\"course_cmu_15-445_fall2025_proj0.md\":\"BrukRXTd\",\"index.md\":\"DB1jtIQq\",\"markdown-examples.md\":\"Cgjcs-U_\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Aiontropy\",\"description\":\"blog\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"sidebar\":[{\"text\":\"course\",\"items\":[{\"text\":\"6.S081\",\"link\":\"./course/6.S081/6.S081\"},{\"text\":\"CMU_15-445\",\"link\":\"./course/CMU_15-445/CMU_15-445\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://aiontropy.github.io/\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>